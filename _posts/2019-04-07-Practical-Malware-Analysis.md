---
layout: post
title:  "Practical Malware Analysis Lab 01"
description: Exercise Lab 01
tags: tutorial malware analysis
---
## I. Giới thiệu
Ở chương 1, cuốn sách Practical Malware Analysis sẽ nói về các kỹ thuật Basic Static Analysis và Basic Dynamic Analysis. Phần 1 thì mình sẽ tập trung chủ yếu vào Basic Static Analysis và thực hiện các bài lab 01.

[Link tải lab](https://github.com/mikesiko/PracticalMalwareAnalysis-Labs)

## II. Bài tập
**Lab 1-1**: Lab01-01.exe , Lab01-01.dll

#### **1. Upload the files to VirusTotal and view the reports. Does either file match any existing antivirus signatures?**

Chúng ta sẽ phải upload 2 file là **Lab01-01.exe** và **Lab01-01.dll** lên trang VirusTotal. Đây là 1 trang web chuyên kiểm tra các file có phải độc hại hay không bằng cách sử dụng các engines của các công ty phần mềm bảo mật như CMC, Bkav, Kaspersky, ...
Thông qua đó, chúng ta có thể biết được rằng file chúng ta upload có an toàn hay không, nếu không thì nó là malicious loại gì ? Hành vi của nó ra sao ? Và nhiều thông tin khác.

![Image](https://i.imgur.com/IgNk8pc.png)

![Image](https://i.imgur.com/YlXDOi9.png)


#### **2. When were these files compiled?**

![Image](https://i.imgur.com/Y7OnvC9.png)

![Image](https://i.imgur.com/d89Ts4o.png)

Thông qua mục **Details**, ta biết được thời gian mà 2 file được compile. Tại sao ta phải cần xem xét thông tin này ? Từ dữ kiện này, ta có thể phỏng đoán được 2 file cùng từ 1 gói mà ra, khoảng thời gian file **exe** được compile sau đó là đến file **.dll** rất gần nhau, điều đó có thể cho ta biết rằng file **.exe** sẽ sử dụng hoặc cài đặt file **.dll**.

#### **3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?**

![Image](https://i.imgur.com/8IJimzK.png)

![Image](https://i.imgur.com/vK6YAJS.png)

File Lab01-01.exe được compile bởi Microsoft Visual C++, và Lab01-01.dll được compile bởi Microsoft Visual C++ DLL, và 2 file này không **packed** hoặc **obfuscated**. 

#### **4. Do any imports hint at what this malware does? If so, which imports are they?**

![Image](https://i.imgur.com/Uppdzj8.png)

![Image](https://i.imgur.com/IFvL82r.png)


#### **5. Are there any other files or host-based indicators that you could look for on infected systems?**

![Image](https://i.imgur.com/2rZ6rm1.png)

Có thể đường dẫn đến thưc mục Systems trong Windows: ***C:\Windows\system32\kerne132.dll***. **Kernel32.dll** là file xử lý việc sử dụng bộ nhớ trong Windows, đây là một trong những file rất quan trọng trong hệ thống. Ta nhìn thấy ở trên, file này được fake bằng file **kerne132.dll**, chỉ cần 1 thay đổi nhỏ giữa chứ ***l*** và số ***1*** đã có thể đánh lừa người dùng. Đường dẫn này được xuất hiện ở khi phân tích file **Lab01-01.exe**. 

#### **6.What network-based indicators could be used to find this malware on infected machines?**

Trong mục **SECTION.DATA** của file Lab01-01.dll, ta có thể thấy được địa chỉ IP: **127.26.152.13**,
địa chỉ này có thể là địa chỉ của máy tấn công, thông tin sẽ được gửi đến đây. Thực tế, nó sẽ là một địa chỉ mạng ngoài chứ không phải là loal.

#### **7.What would you guess is the purpose of these files?**

Khi thực thi file **Lab01-01.exe**, nó sẽ tiến hành sử dụng file **Lab01-01.dll**. Trong file **.dll**, có import các thư viện liên quan đến **socket** : **WS2_32.dll**. Kèm với dữ kiện ở câu 6, ta có thể suy đoán chương trình này sẽ tạo một socket trên máy nạn nhân kết nói kẻ tấn công, còn gọi là kiểu mã độc **backdoor**, sau khi tạo kết nối xong, kẻ tân công có thể kiểm soát, lấy thông tin từ máy nạn nhân. 

## III. Kết luận
Vì đây là lab khởi đầu nên ta chưa cần thiết phải đi sâu vào việc phân xem backdoor đó sẽ có những hoạt động gì ? Bài lab này chỉ là phần hướng dẫn mở đầu cho bạn đọc biết hướng phân tích như thế nào bằng cách trả lời các câu hỏi, ta có thể áp dụng phương pháp phân tích này cho các bài lab sau, rồi từ đó cải thiện kỹ năng phân tích của mình.

Thanks & Best regrads!

